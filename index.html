<!DOCTYPE html>
<html>
  <body>
    <h1>The onclick Event</h1>

    <button onclick="getDevice()">Click me</button>

    <p id="demo"></p>

    <script>
      async function getDevice() {
        navigator.bluetooth
          .requestDevice({ filters: [{ services: [0x180f] }] })
          .then(device => device.gatt.connect())
          .then(server => server.getPrimaryService(0x180f))
          .then(service => service.getCharacteristic(0x2a19))
          .then(characteristic => characteristic.startNotifications())
          .then(characteristic => {
            // Set up event listener for when characteristic value changes.
            characteristic.addEventListener(
              'characteristicvaluechanged',
              handleBatteryLevelChanged
            );
            // Reading Battery Level...
            return characteristic.readValue();
          })
          .catch(error => {
            console.log(error);
          });

        function handleBatteryLevelChanged(event) {
          let batteryLevel = event.target.value.getUint8(0);
          document.write('Battery percentage is ' + batteryLevel);
        }
      }
    </script>
  </body>
</html>
